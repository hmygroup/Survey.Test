<Page x:Class="SurveyApp.Views.QuestionaryListView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      xmlns:vm="clr-namespace:SurveyApp.ViewModels"
      mc:Ignorable="d"
      d:DataContext="{d:DesignInstance Type=vm:QuestionaryListViewModel}"
      d:DesignHeight="600" d:DesignWidth="1000"
      Loaded="Page_Loaded">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="ðŸ“‹ Questionnaires" 
                          FontSize="28" 
                          FontWeight="SemiBold"
                          Margin="0,0,0,4" />
                <TextBlock Text="Manage your questionnaires and surveys" 
                          FontSize="14" 
                          Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
            </StackPanel>

            <StackPanel Grid.Column="1"
                       Orientation="Horizontal"
                       VerticalAlignment="Center">
                <ui:Button Command="{Binding RefreshCommand}"
                           ToolTip="Refresh list"
                           Appearance="Secondary"
                           Margin="0,0,8,0">
                    <ui:Button.Icon>
                        <ui:SymbolIcon Symbol="ArrowSync20" />
                    </ui:Button.Icon>
                    <ui:Button.Content>
                        <TextBlock Text="Refresh" Margin="8,0,0,0" />
                    </ui:Button.Content>
                </ui:Button>
                <ui:Button Command="{Binding CreateQuestionaryCommand}"
                           ToolTip="Create new questionnaire"
                           Appearance="Primary">
                    <ui:Button.Icon>
                        <ui:SymbolIcon Symbol="Add20" />
                    </ui:Button.Icon>
                    <ui:Button.Content>
                        <TextBlock Text="New Questionnaire" Margin="8,0,0,0" />
                    </ui:Button.Content>
                </ui:Button>
            </StackPanel>
        </Grid>

        <!-- Search Box -->
        <ui:AutoSuggestBox Grid.Row="1"
                          PlaceholderText="Search questionnaires by name, description, or creator..."
                          Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          Width="400"
                          HorizontalAlignment="Left"
                          Margin="0,0,0,16" />

        <!-- Action Bar -->
        <StackPanel Grid.Row="2"
                   Orientation="Horizontal"
                   Margin="0,0,0,16">
            <ui:Button Command="{Binding ViewDetailsCommand}"
                       IsEnabled="{Binding SelectedQuestionary, Converter={StaticResource NullToBooleanConverter}}"
                       ToolTip="View details"
                       Appearance="Secondary"
                       Margin="0,0,8,0">
                <ui:Button.Icon>
                    <ui:SymbolIcon Symbol="Document20" />
                </ui:Button.Icon>
                <ui:Button.Content>
                    <TextBlock Text="View Details" Margin="8,0,0,0" />
                </ui:Button.Content>
            </ui:Button>
            <ui:Button Command="{Binding ViewResponsesCommand}"
                       IsEnabled="{Binding SelectedQuestionary, Converter={StaticResource NullToBooleanConverter}}"
                       ToolTip="View responses and analysis"
                       Appearance="Primary"
                       Margin="0,0,8,0">
                <ui:Button.Icon>
                    <ui:SymbolIcon Symbol="DocumentBulletList20" />
                </ui:Button.Icon>
                <ui:Button.Content>
                    <TextBlock Text="View Responses" Margin="8,0,0,0" />
                </ui:Button.Content>
            </ui:Button>
            <ui:Button Command="{Binding EditQuestionaryCommand}"
                       IsEnabled="{Binding SelectedQuestionary, Converter={StaticResource NullToBooleanConverter}}"
                       ToolTip="Edit questionnaire"
                       Appearance="Secondary"
                       Margin="0,0,8,0">
                <ui:Button.Icon>
                    <ui:SymbolIcon Symbol="Edit20" />
                </ui:Button.Icon>
                <ui:Button.Content>
                    <TextBlock Text="Edit" Margin="8,0,0,0" />
                </ui:Button.Content>
            </ui:Button>
            <ui:Button Command="{Binding DeleteQuestionaryCommand}"
                       IsEnabled="{Binding SelectedQuestionary, Converter={StaticResource NullToBooleanConverter}}"
                       ToolTip="Delete questionnaire"
                       Appearance="Danger">
                <ui:Button.Icon>
                    <ui:SymbolIcon Symbol="Delete20" />
                </ui:Button.Icon>
                <ui:Button.Content>
                    <TextBlock Text="Delete" Margin="8,0,0,0" />
                </ui:Button.Content>
            </ui:Button>
        </StackPanel>

        <!-- Questionnaire Cards -->
        <ListBox Grid.Row="3"
                 ItemsSource="{Binding FilteredQuestionnaires}"
                 SelectedItem="{Binding SelectedQuestionary, Mode=TwoWay}"
                 Background="Transparent"
                 BorderThickness="0"
                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                 Margin="0,0,0,16">
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <ui:CardControl Margin="0,0,16,16"
                                   Width="350"
                                   Cursor="Hand"
                                   MouseDoubleClick="CardControl_MouseDoubleClick">
                        <ui:CardControl.Style>
                            <Style TargetType="ui:CardControl" BasedOn="{StaticResource {x:Type ui:CardControl}}">
                                <Setter Property="BorderBrush" Value="Transparent"/>
                                <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundAltHighBrush}"/>
                                <Setter Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect BlurRadius="0" ShadowDepth="0" Color="Transparent"/>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" Value="True">
                                        <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}"/>
                                        <Setter Property="BorderThickness" Value="2"/>
                                        <Setter Property="Effect">
                                            <Setter.Value>
                                                <DropShadowEffect BlurRadius="8" ShadowDepth="2" Color="{DynamicResource SystemAccentColor}" Opacity="0.3"/>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                                        <Setter Property="BorderThickness" Value="1"/>
                                        <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundAltMediumHighBrush}"/>
                                        <Setter Property="Effect">
                                            <Setter.Value>
                                                <DropShadowEffect BlurRadius="6" ShadowDepth="1" Color="{DynamicResource SystemControlForegroundBaseMediumBrush}" Opacity="0.2"/>
                                            </Setter.Value>
                                        </Setter>
                                        <Setter Property="RenderTransform">
                                            <Setter.Value>
                                                <ScaleTransform ScaleX="1.02" ScaleY="1.02"/>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ui:CardControl.Style>
                        <Grid Margin="16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Icon and Header -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                <ui:SymbolIcon Symbol="DocumentBulletList20" 
                                               FontSize="24" 
                                               Foreground="{DynamicResource SystemAccentColor}" 
                                               Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding Name}"
                                          FontSize="18"
                                          FontWeight="Bold"
                                          TextWrapping="Wrap"/>
                            </StackPanel>
                            
                            <!-- Description and Details -->
                            <StackPanel Grid.Row="1" Margin="0,0,0,12">
                                <TextBlock Text="{Binding Description}"
                                          FontSize="14"
                                          Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                          TextWrapping="Wrap"
                                          MaxHeight="40"
                                          TextTrimming="CharacterEllipsis"
                                          Margin="0,0,0,8"/>
                                <Border Background="{DynamicResource SystemControlBackgroundBaseLowBrush}" 
                                        CornerRadius="4" 
                                        Padding="8,4" 
                                        Margin="0,0,0,8">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Created by"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                                        <TextBlock Text="{Binding CreatedBy}"
                                                  FontSize="12"
                                                  FontWeight="SemiBold"
                                                  Margin="4,0,0,0"/>
                                        <TextBlock Text="on"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                                  Margin="8,0,0,0"/>
                                        <TextBlock Text="{Binding CreationDate, StringFormat='{}{0:yyyy-MM-dd}'}"
                                                  FontSize="12"
                                                  Margin="4,0,0,0"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                            
                            <!-- Action Buttons -->
                            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                                <ui:Button Command="{Binding DataContext.ViewDetailsCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                          CommandParameter="{Binding}"
                                          Appearance="Secondary"
                                          Margin="0,0,8,0"
                                          ToolTip="View Details">
                                    <ui:Button.Icon>
                                        <ui:SymbolIcon Symbol="Document20"/>
                                    </ui:Button.Icon>
                                </ui:Button>
                                <ui:Button Command="{Binding DataContext.EditQuestionaryCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                          CommandParameter="{Binding}"
                                          Appearance="Secondary"
                                          Margin="0,0,8,0"
                                          ToolTip="Edit">
                                    <ui:Button.Icon>
                                        <ui:SymbolIcon Symbol="Edit20"/>
                                    </ui:Button.Icon>
                                </ui:Button>
                                <ui:Button Command="{Binding DataContext.DeleteQuestionaryCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                          CommandParameter="{Binding}"
                                          Appearance="Danger"
                                          ToolTip="Delete">
                                    <ui:Button.Icon>
                                        <ui:SymbolIcon Symbol="Delete20"/>
                                    </ui:Button.Icon>
                                </ui:Button>
                            </StackPanel>
                        </Grid>
                    </ui:CardControl>
                </DataTemplate>
            </ListBox.ItemTemplate>
            <ListBox.ItemContainerStyle>
                <Style TargetType="ListBoxItem">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="Padding" Value="0"/>
                    <Setter Property="Margin" Value="0"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ListBoxItem">
                                <ContentPresenter />
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ListBox.ItemContainerStyle>
        </ListBox>

        <!-- Status Bar -->
        <Border Grid.Row="4"
               Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
               Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

            <ui:ProgressRing Grid.Column="0" Width="20"
                           Height="20"
                           Margin="0,0,8,0" />

            <TextBlock Grid.Column="1"
                      Text="{Binding StatusMessage}"
                      VerticalAlignment="Center"
                      FontSize="12" />

            <TextBlock Grid.Column="2"
                      VerticalAlignment="Center"
                      FontSize="12"
                      Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}">
                <Run Text="{Binding FilteredQuestionnaires.Count, Mode=OneWay}" />
                <Run Text="item(s)" />
            </TextBlock>
            </Grid>
        </Border>
    </Grid>
</Page>
