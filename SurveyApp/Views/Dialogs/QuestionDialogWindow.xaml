<Window x:Class="SurveyApp.Views.Dialogs.QuestionDialogWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        xmlns:vm="clr-namespace:SurveyApp.ViewModels"
        xmlns:controls="clr-namespace:SurveyApp.Views.Controls"
        mc:Ignorable="d"
        d:DataContext="{d:DesignInstance Type=vm:QuestionDialogViewModel}"
        ui:WindowHelper.UseModernWindowStyle="True"
        Title="{Binding Title}"
        Height="750"
        Width="900"
        MinHeight="650"
        MinWidth="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">
    
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,24">
            <TextBlock Text="{Binding HeaderText}" 
                      FontSize="24" 
                      FontWeight="SemiBold"
                      Margin="0,0,0,8" />
            <TextBlock Text="{Binding SubHeaderText}" 
                      FontSize="14" 
                      Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
        </StackPanel>

        <!-- Form Fields -->
        <StackPanel Grid.Row="2">
            <!-- Question Text Field -->
            <TextBlock Text="Question Text *" 
                      FontWeight="SemiBold"
                      Margin="0,0,0,8" />
            <TextBox Text="{Binding QuestionText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    AcceptsReturn="True"
                    TextWrapping="Wrap"
                    VerticalScrollBarVisibility="Auto"
                    Height="120"
                    Margin="0,0,0,16"
                    ui:ControlHelper.PlaceholderText="Enter your question here..."
                    MaxLength="500" />

            <!-- Question Type Field -->
            <TextBlock Text="Question Type *" 
                      FontWeight="SemiBold"
                      Margin="0,0,0,8" />
            <ComboBox ItemsSource="{Binding QuestionTypes}"
                     SelectedItem="{Binding SelectedQuestionType, Mode=TwoWay}"
                     Margin="0,0,0,16"
                     Height="32"
                     ui:ControlHelper.PlaceholderText="Select question type..." />

            <!-- Type Description -->
            <Border Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                   Padding="12"
                   CornerRadius="4"
                   Margin="0,0,0,16">
                <StackPanel>
                    <TextBlock FontWeight="SemiBold" Margin="0,0,0,4">
                        <Run Text="ℹ️" />
                        <Run Text="Question Type Guide" />
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}">
                        <Run Text="• System.String:" FontWeight="Medium" />
                        <Run Text="Text input (short answer, paragraphs)" />
                        <LineBreak />
                        <Run Text="• System.Boolean:" FontWeight="Medium" />
                        <Run Text="Yes/No or True/False questions" />
                        <LineBreak />
                        <Run Text="• System.Int32:" FontWeight="Medium" />
                        <Run Text="Whole numbers (age, quantity)" />
                        <LineBreak />
                        <Run Text="• System.Decimal:" FontWeight="Medium" />
                        <Run Text="Numbers with decimals (price, rating)" />
                        <LineBreak />
                        <Run Text="• System.DateTime:" FontWeight="Medium" />
                        <Run Text="Date and time selection" />
                        <LineBreak />
                        <Run Text="• System.Byte[]:" FontWeight="Medium" />
                        <Run Text="File upload (documents, images)" />
                    </TextBlock>
                </StackPanel>
            </Border>

            <!-- Constraint Editor -->
            <controls:ConstraintEditorView x:Name="ConstraintEditor"
                                          Margin="0,0,0,16" />

            <!-- Validation Message -->
            <TextBlock Text="{Binding ValidationMessage}"
                      Foreground="Red"
                      FontSize="12"
                      Margin="0,8,0,0"
                      Visibility="{Binding HasValidationError, Converter={StaticResource BooleanToVisibilityConverter}}" />
        </StackPanel>

        <!-- Action Buttons -->
        <Grid Grid.Row="3" Margin="0,24,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <Button Grid.Column="1"
                   Content="Cancel"
                   IsCancel="True"
                   Click="CancelButton_Click"
                   Padding="24,8"
                   MinWidth="100"
                   Margin="0,0,8,0" />

            <Button Grid.Column="2"
                   Content="{Binding SaveButtonText}"
                   IsDefault="True"
                   Click="SaveButton_Click"
                   Style="{StaticResource AccentButtonStyle}"
                   Padding="24,8"
                   MinWidth="100"
                   IsEnabled="{Binding CanSave}" />
        </Grid>
    </Grid>
</Window>
